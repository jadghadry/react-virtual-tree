{"version":3,"sources":["../src/constants.ts","../src/engine.ts","../src/tree.tsx"],"names":["CheckedState","state","isExpanded","checkedState"],"mappings":"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","file":"index.mjs","sourcesContent":["export enum CheckedState {\r\n  Checked = \"checked\",\r\n  Indeterminate = \"indeterminate\",\r\n  Unchecked = \"unchecked\",\r\n}\r\n","import { CheckedState } from \"./constants\";\r\nimport { TreeDefinition } from \"./types\";\r\n\r\n/**\r\n * Represents an item that should be visible in the tree view.\r\n * Used by the rendering system to display the flattened tree structure.\r\n */\r\ntype VisibleItem = {\r\n  id: string;\r\n  isExpanded: boolean;\r\n  isFolder: boolean;\r\n  level: number;\r\n};\r\n\r\n/**\r\n * High-performance tree engine that manages checkbox states, expansion, and search filtering.\r\n *\r\n * This engine provides:\r\n * - Fast checkbox state computation with proper parent/child relationships\r\n * - Efficient search filtering that shows only matching items and their ancestors\r\n * - Optimized rendering through caching and minimal re-computation\r\n * - Dual-mode operation: full tree view vs search-filtered view\r\n */\r\nexport class Engine {\r\n  private allCheckedCache: string[] = [];\r\n  private allCheckedCacheVersion = -1;\r\n  private assignments = new Map<string, boolean>();\r\n  private childrenMap = new Map<string, string[]>();\r\n  private expanded = new Set<string>();\r\n  private expandVersion = 0;\r\n  private flatCacheVersion = -1;\r\n  private flatVisibleItems: VisibleItem[] = [];\r\n  private folderSet = new Set<string>();\r\n  private indexById: Map<string, number> = new Map();\r\n  private labelMap = new Map<string, string>();\r\n  private leafIds: string[] = [];\r\n  private minSearchChars = 3;\r\n  private normalizedLeafLabel = new Map<string, string>();\r\n  private normalizedQuery = \"\";\r\n  private observers = new Set<() => void>();\r\n  private parentMap = new Map<string, null | string>();\r\n  private rootId: string;\r\n  private searchActive = false;\r\n  private searchEpoch = 0; // bumps on every query change\r\n  private searchQuery = \"\";\r\n  private selectionVersion = 0;\r\n  private stateCache = new Map<string, CheckedState>(); // full tree cache\r\n  private stateCacheFiltered = new Map<string, CheckedState>(); // filtered-view cache\r\n  private version = 0;\r\n  private visibleChildrenMap = new Map<string, string[]>();\r\n  private visibleSet = new Set<string>();\r\n\r\n  /**\r\n   * Creates a new tree engine from hierarchical data.\r\n   *\r\n   * @param data - Tree structure where each key is a node ID and value contains children and label\r\n   * @param opts - Configuration options for root ID, initial expansion, and search behavior\r\n   */\r\n  constructor(\r\n    data: TreeDefinition,\r\n    opts?: {\r\n      initialExpanded?: string[];\r\n      minSearchChars?: number;\r\n      rootId?: string;\r\n    }\r\n  ) {\r\n    this.rootId = opts?.rootId ?? \"__root__\";\r\n    if (opts?.minSearchChars) this.minSearchChars = opts.minSearchChars;\r\n\r\n    // Build structure\r\n    for (const [id, item] of Object.entries(data)) {\r\n      const children = item.children || [];\r\n      this.childrenMap.set(id, children);\r\n      this.labelMap.set(id, (item as any).label ?? id);\r\n\r\n      if (children.length > 0) {\r\n        this.folderSet.add(id);\r\n      } else {\r\n        this.leafIds.push(id);\r\n      }\r\n      for (const child of children) {\r\n        this.parentMap.set(child, id);\r\n      }\r\n    }\r\n    if (!this.parentMap.has(this.rootId)) this.parentMap.set(this.rootId, null);\r\n\r\n    // Initial expanded\r\n    if (opts?.initialExpanded)\r\n      opts.initialExpanded.forEach((id) => this.expanded.add(id));\r\n    if (this.folderSet.has(this.rootId)) this.expanded.add(this.rootId);\r\n\r\n    // Pre-normalize leaf labels (diacritics + lowercase)\r\n    for (const leafId of this.leafIds) {\r\n      const raw = this.labelMap.get(leafId) ?? leafId;\r\n      this.normalizedLeafLabel.set(leafId, Engine.normalize(raw));\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Normalizes text by removing diacritics and converting to lowercase.\r\n   * Used for consistent search matching across different character sets.\r\n   */\r\n  private static normalize(s: string): string {\r\n    return s\r\n      .normalize(\"NFD\")\r\n      .replace(/[\\u0300-\\u036f]/g, \"\")\r\n      .toLowerCase();\r\n  }\r\n\r\n  /**\r\n   * Collapses all folders except the root.\r\n   * Useful for resetting the tree to a minimal view.\r\n   */\r\n  collapseAll() {\r\n    this.expanded.clear();\r\n    if (this.folderSet.has(this.rootId)) this.expanded.add(this.rootId);\r\n    this.bumpNoRecompute();\r\n  }\r\n\r\n  /**\r\n   * Expands all folders in the tree.\r\n   * Useful for showing the complete tree structure at once.\r\n   */\r\n  expandAll() {\r\n    for (const id of this.folderSet) this.expanded.add(id);\r\n    this.bumpNoRecompute();\r\n  }\r\n\r\n  getAllChecked(): string[] {\r\n    if (this.allCheckedCacheVersion === this.selectionVersion)\r\n      return this.allCheckedCache;\r\n\r\n    const result: string[] = [];\r\n    for (const [id] of this.childrenMap) {\r\n      if (\r\n        !this.folderSet.has(id) &&\r\n        this.getStateBase(id) === CheckedState.Checked\r\n      ) {\r\n        result.push(id);\r\n      }\r\n    }\r\n    this.allCheckedCache = result;\r\n    this.allCheckedCacheVersion = this.selectionVersion;\r\n    return this.allCheckedCache;\r\n  }\r\n\r\n  /**\r\n   * Returns all currently expanded folder IDs.\r\n   * Expanded folders show their children in the tree view.\r\n   *\r\n   * @returns Array of folder IDs that are expanded\r\n   */\r\n  getExpanded(): string[] {\r\n    return Array.from(this.expanded);\r\n  }\r\n\r\n  getExpandVersion() {\r\n    return this.expandVersion;\r\n  }\r\n\r\n  /**\r\n   * Gets the display label for a node.\r\n   * Falls back to the node ID if no label is defined.\r\n   *\r\n   * @param id - The node ID\r\n   * @returns The display label for the node\r\n   */\r\n  getLabel(id: string): string {\r\n    return this.labelMap.get(id) ?? id;\r\n  }\r\n\r\n  /**\r\n   * Gets the current search query string.\r\n   *\r\n   * @returns The active search query\r\n   */\r\n  getSearchQuery() {\r\n    return this.searchQuery;\r\n  }\r\n\r\n  getSelectionVersion() {\r\n    return this.selectionVersion;\r\n  }\r\n\r\n  /**\r\n   * Gets the checkbox state for a node, accounting for current view mode.\r\n   * In search mode, only considers visible children when computing folder states.\r\n   * In normal mode, considers all children for folder state computation.\r\n   *\r\n   * @param id - The node ID\r\n   * @returns CheckedState (Checked, Unchecked, or Indeterminate)\r\n   */\r\n  getViewState(id: string): CheckedState {\r\n    return this.searchActive\r\n      ? this.getStateFiltered(id)\r\n      : this.getStateBase(id);\r\n  }\r\n\r\n  /**\r\n   * Returns the flattened list of visible items for rendering.\r\n   * Handles both normal tree view and search-filtered view.\r\n   * Results are cached for performance and only recomputed when needed.\r\n   *\r\n   * @returns Array of items that should be visible in the current view\r\n   */\r\n  getVisibleItems(): VisibleItem[] {\r\n    // invalidate when either content changes (version) or search overlay changes (searchEpoch)\r\n    const cacheKey = (this.version << 8) ^ this.searchEpoch;\r\n    if (this.flatCacheVersion === cacheKey) return this.flatVisibleItems;\r\n\r\n    const out: VisibleItem[] = [];\r\n    this.indexById.clear();\r\n\r\n    const visit = (id: string, level: number) => {\r\n      const c = this.searchActive\r\n        ? this.visibleChildrenMap.get(id) || []\r\n        : this.childrenMap.get(id) || [];\r\n      if (id !== this.rootId) {\r\n        const isFolder = this.folderSet.has(id);\r\n        const hasVisibleChildren = c.length > 0;\r\n        const effectiveFolder = this.searchActive\r\n          ? hasVisibleChildren\r\n          : isFolder;\r\n\r\n        const isExpanded = effectiveFolder && this.expanded.has(id);\r\n        const v: VisibleItem = {\r\n          id,\r\n          isExpanded,\r\n          isFolder: effectiveFolder,\r\n          level,\r\n        };\r\n        this.indexById.set(id, out.length);\r\n        out.push(v);\r\n\r\n        if (!effectiveFolder || !isExpanded) return;\r\n      }\r\n\r\n      for (const child of c) {\r\n        visit(child, id === this.rootId ? 0 : level + 1);\r\n      }\r\n    };\r\n\r\n    visit(this.rootId, -1); // root not rendered\r\n    this.flatVisibleItems = out;\r\n    this.flatCacheVersion = cacheKey;\r\n    return out;\r\n  }\r\n  /**\r\n   * Gets the index position of a node in the flattened visible items list.\r\n   * Used for virtual scrolling and finding specific items in the rendered view.\r\n   *\r\n   * @param id - The node ID\r\n   * @returns The index position, or -1 if not found\r\n   */\r\n  indexOf(id: string): number {\r\n    this.getVisibleItems(); // Ensure index map is up-to-date\r\n    return this.indexById.get(id) ?? -1;\r\n  }\r\n  /**\r\n   * Checks if a folder is currently expanded.\r\n   *\r\n   * @param id - The folder ID\r\n   * @returns True if the folder is expanded\r\n   */\r\n  isExpanded(id: string) {\r\n    return this.expanded.has(id);\r\n  }\r\n  /**\r\n   * Checks if search filtering is currently active.\r\n   * Search is active when the query length meets the minimum character threshold.\r\n   *\r\n   * @returns True if search filtering is active\r\n   */\r\n  isSearchActive() {\r\n    return this.searchActive;\r\n  }\r\n  /**\r\n   * Sets which leaf nodes should be checked (controlled state).\r\n   * Automatically filters out non-leaf nodes and updates the UI.\r\n   * Only triggers re-render if the selection actually changed.\r\n   *\r\n   * @param input - Array of node IDs that should be checked\r\n   */\r\n  setChecked(input: string[], silent = false) {\r\n    const n = new Set<string>();\r\n    for (const id of input) if (!this.folderSet.has(id)) n.add(id);\r\n\r\n    const o = new Set(this.getAllChecked());\r\n    if (this.setsEqual(n, o)) return;\r\n\r\n    this.assignments.clear();\r\n    for (const id of n) this.assignments.set(id, true);\r\n    this.notify(silent);\r\n  }\r\n  /**\r\n   * Sets which folders should be expanded (controlled state).\r\n   * Root folder is always kept expanded to maintain tree structure.\r\n   * Only triggers re-render if the expansion state actually changed.\r\n   *\r\n   * @param ids - Array of folder IDs that should be expanded\r\n   */\r\n  setExpanded(ids: string[]) {\r\n    const next = new Set(ids);\r\n    if (this.setsEqual(next, this.expanded)) return;\r\n    this.expanded = next;\r\n    if (this.folderSet.has(this.rootId)) this.expanded.add(this.rootId);\r\n    this.bumpNoRecompute(); // only a layout change\r\n  }\r\n\r\n  /**\r\n   * Sets the minimum number of characters required to activate search.\r\n   * Prevents performance issues from very short search queries.\r\n   *\r\n   * @param n - Minimum character count (must be at least 1)\r\n   */\r\n  setMinSearchChars(n: number) {\r\n    if (n < 1) n = 1;\r\n    if (this.minSearchChars === n) return;\r\n    this.minSearchChars = n;\r\n    // reapply current query against new threshold\r\n    this.setSearchQuery(this.searchQuery);\r\n  }\r\n\r\n  setSearchQuery(query: string) {\r\n    const raw = query ?? \"\";\r\n    const q = Engine.normalize(raw);\r\n\r\n    if (q === this.normalizedQuery) {\r\n      this.searchQuery = raw;\r\n      return;\r\n    }\r\n\r\n    const wasActive = this.searchActive;\r\n    this.searchQuery = raw;\r\n    this.normalizedQuery = q;\r\n    this.searchActive = q.length >= this.minSearchChars;\r\n\r\n    this.visibleSet.clear();\r\n    this.visibleChildrenMap.clear();\r\n    this.stateCacheFiltered.clear();\r\n\r\n    if (this.searchActive) {\r\n      const matches: string[] = [];\r\n      for (let i = 0; i < this.leafIds.length; i++) {\r\n        const id = this.leafIds[i];\r\n        if ((this.normalizedLeafLabel.get(id) ?? \"\").includes(q))\r\n          matches.push(id);\r\n      }\r\n\r\n      for (const leaf of matches) {\r\n        this.visibleSet.add(leaf);\r\n        let p = this.parentMap.get(leaf);\r\n        while (p) {\r\n          this.visibleSet.add(p);\r\n          p = this.parentMap.get(p);\r\n        }\r\n      }\r\n      this.visibleSet.add(this.rootId);\r\n\r\n      for (const id of this.visibleSet) {\r\n        const origChildren = this.childrenMap.get(id) || [];\r\n        const restricted = origChildren.filter((c) => this.visibleSet.has(c));\r\n        if (restricted.length > 0) this.visibleChildrenMap.set(id, restricted);\r\n      }\r\n\r\n      this.expanded.clear();\r\n      this.expanded.add(this.rootId);\r\n      for (const id of this.visibleSet)\r\n        if (this.folderSet.has(id)) this.expanded.add(id);\r\n    } else {\r\n      if (wasActive) {\r\n        this.expanded.clear();\r\n        this.expanded.add(this.rootId);\r\n      }\r\n    }\r\n\r\n    this.searchEpoch++;\r\n    // layout-only bump\r\n    this.version++;\r\n    this.expandVersion++;\r\n    this.flatCacheVersion = -1;\r\n    for (const ob of this.observers) ob();\r\n  }\r\n\r\n  /**\r\n   * Subscribes to engine state changes.\r\n   * Callback is fired whenever the tree state changes and UI should re-render.\r\n   *\r\n   * @param cb - Function to call when state changes\r\n   * @returns Cleanup function to remove the subscription\r\n   */\r\n  subscribe(cb: () => void) {\r\n    this.observers.add(cb);\r\n    return () => void this.observers.delete(cb);\r\n  }\r\n\r\n  /**\r\n   * Toggles the checked state of a node.\r\n   * Behavior depends on current view mode:\r\n   * - Normal mode: affects the node and all its descendants\r\n   * - Search mode: affects only visible descendants (filtered by search)\r\n   *\r\n   * @param id - The node ID to toggle\r\n   * @param checked - True to check, false to uncheck\r\n   */\r\n  toggle(id: string, checked: boolean) {\r\n    if (this.searchActive) {\r\n      this.toggleVisibleOnly(id, checked);\r\n    } else {\r\n      this.toggleFull(id, checked);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Toggles the expanded/collapsed state of a folder.\r\n   * Only works on folder nodes; leaf nodes cannot be expanded.\r\n   * Root folder is always kept expanded.\r\n   *\r\n   * @param id - The folder ID to toggle\r\n   */\r\n  toggleExpanded(id: string) {\r\n    if (!this.folderSet.has(id)) return;\r\n    if (this.expanded.has(id)) this.expanded.delete(id);\r\n    else this.expanded.add(id);\r\n    if (id === this.rootId && !this.expanded.has(this.rootId))\r\n      this.expanded.add(this.rootId);\r\n    this.bumpNoRecompute();\r\n  }\r\n\r\n  private bumpNoRecompute() {\r\n    this.version++;\r\n    this.expandVersion++;\r\n    this.flatCacheVersion = -1;\r\n    for (const ob of this.observers) ob();\r\n  }\r\n\r\n  /**\r\n   * Recursively clears all checkbox assignments in a subtree.\r\n   * Used when setting a parent checkbox to avoid conflicting child states.\r\n   */\r\n  private clearSubtreeAssignments(id: string) {\r\n    const children = this.childrenMap.get(id) || [];\r\n    for (const child of children) {\r\n      this.assignments.delete(child);\r\n      this.clearSubtreeAssignments(child);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Finds the nearest explicit checkbox assignment by walking up the parent chain.\r\n   * Used to determine effective checkbox state when no direct assignment exists.\r\n   *\r\n   * @param id - Starting node ID\r\n   * @returns The nearest boolean assignment, or undefined if none found\r\n   */\r\n  private findNearestAssignment(id: string): boolean | undefined {\r\n    let current: null | string = id;\r\n    while (current) {\r\n      if (this.assignments.has(current)) return this.assignments.get(current);\r\n      current = this.parentMap.get(current) || null;\r\n    }\r\n    return undefined;\r\n  }\r\n\r\n  /**\r\n   * Computes checkbox state using the full tree structure.\r\n   * Considers all children when determining folder states.\r\n   * Results are cached for performance.\r\n   *\r\n   * @param id - The node ID\r\n   * @returns The computed checkbox state\r\n   */\r\n  private getStateBase(id: string): CheckedState {\r\n    if (this.stateCache.has(id)) return this.stateCache.get(id)!;\r\n\r\n    const children = this.childrenMap.get(id) || [];\r\n\r\n    // treat \"no children\" as leaf\r\n    if (children.length === 0) {\r\n      const forced = this.findNearestAssignment(id);\r\n      const state =\r\n        forced === true ? CheckedState.Checked : CheckedState.Unchecked;\r\n      this.stateCache.set(id, state);\r\n      return state;\r\n    }\r\n\r\n    // folder: summarize over *all* children\r\n    let checkedCount = 0;\r\n    for (const c of children) {\r\n      const st = this.getStateBase(c);\r\n      if (st === CheckedState.Indeterminate) {\r\n        this.stateCache.set(id, CheckedState.Indeterminate);\r\n        return CheckedState.Indeterminate;\r\n      }\r\n      if (st === CheckedState.Checked) checkedCount++;\r\n    }\r\n    const state =\r\n      checkedCount === 0\r\n        ? CheckedState.Unchecked\r\n        : checkedCount === children.length\r\n        ? CheckedState.Checked\r\n        : CheckedState.Indeterminate;\r\n    this.stateCache.set(id, state);\r\n    return state;\r\n  }\r\n\r\n  /**\r\n   * Computes checkbox state using only visible items in search mode.\r\n   * Only considers visible children when determining folder states.\r\n   * Used to show accurate checkbox states during search filtering.\r\n   *\r\n   * @param id - The node ID\r\n   * @returns The computed checkbox state for filtered view\r\n   */\r\n  private getStateFiltered(id: string): CheckedState {\r\n    if (this.stateCacheFiltered.has(id))\r\n      return this.stateCacheFiltered.get(id)!;\r\n\r\n    const children = this.searchActive\r\n      ? this.visibleChildrenMap.get(id) || []\r\n      : this.childrenMap.get(id) || [];\r\n\r\n    // In filtered view, \"leaf\" == \"no VISIBLE children\"\r\n    if (children.length === 0) {\r\n      const forced = this.findNearestAssignment(id);\r\n      const state =\r\n        forced === true ? CheckedState.Checked : CheckedState.Unchecked;\r\n      this.stateCacheFiltered.set(id, state);\r\n      return state;\r\n    }\r\n\r\n    // folder: summarize *only visible* children\r\n    let checkedCount = 0;\r\n    for (const c of children) {\r\n      const st = this.getStateFiltered(c);\r\n      if (st === CheckedState.Indeterminate) {\r\n        this.stateCacheFiltered.set(id, CheckedState.Indeterminate);\r\n        return CheckedState.Indeterminate;\r\n      }\r\n      if (st === CheckedState.Checked) checkedCount++;\r\n    }\r\n    const state =\r\n      checkedCount === 0\r\n        ? CheckedState.Unchecked\r\n        : checkedCount === children.length\r\n        ? CheckedState.Checked\r\n        : CheckedState.Indeterminate;\r\n    this.stateCacheFiltered.set(id, state);\r\n    return state;\r\n  }\r\n\r\n  /**\r\n   * Notifies all observers that the tree state has changed.\r\n   * Clears caches and increments version for change detection.\r\n   * Triggers UI re-render.\r\n   */\r\n  private notify(silent: boolean = false) {\r\n    if (!silent) {\r\n      this.selectionVersion++;\r\n    }\r\n    this.version++;\r\n    this.stateCache.clear();\r\n    this.stateCacheFiltered.clear();\r\n    this.flatCacheVersion = -1;\r\n    this.allCheckedCacheVersion = -1;\r\n    for (const ob of this.observers) ob();\r\n  }\r\n\r\n  /**\r\n   * Checks if two sets contain the same elements.\r\n   * Used for efficient equality comparisons without object serialization.\r\n   *\r\n   * @param a - First set\r\n   * @param b - Second set\r\n   * @returns True if sets contain identical elements\r\n   */\r\n  private setsEqual(a: Set<string>, b: Set<string>) {\r\n    if (a.size !== b.size) return false;\r\n    for (const v of a) if (!b.has(v)) return false;\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Toggles checkbox state using full tree semantics.\r\n   * Sets the target node and clears all descendant assignments.\r\n   * This ensures consistent parent-child checkbox relationships.\r\n   *\r\n   * @param id - The node ID to toggle\r\n   * @param checked - True to check, false to uncheck\r\n   */\r\n  private toggleFull(id: string, checked: boolean) {\r\n    this.assignments.set(id, checked);\r\n    this.clearSubtreeAssignments(id);\r\n    this.notify();\r\n  }\r\n\r\n  /**\r\n   * Toggles checkbox state for only visible items during search.\r\n   * Affects only leaf nodes that are currently visible in the filtered view.\r\n   * Preserves hidden items' states while updating search results.\r\n   *\r\n   * @param id - The node ID to toggle\r\n   * @param checked - True to check, false to uncheck\r\n   */\r\n  private toggleVisibleOnly(id: string, checked: boolean) {\r\n    const forEachVisibleLeafUnder = (\r\n      start: string,\r\n      fn: (leaf: string) => void\r\n    ) => {\r\n      const stack = [start];\r\n      while (stack.length) {\r\n        const cur = stack.pop()!;\r\n        const children = this.visibleChildrenMap.get(cur) || [];\r\n        if (children.length === 0) {\r\n          if (!this.folderSet.has(cur)) fn(cur);\r\n        } else {\r\n          for (let i = 0; i < children.length; i++) stack.push(children[i]);\r\n        }\r\n      }\r\n    };\r\n\r\n    if (!this.folderSet.has(id)) {\r\n      this.assignments.set(id, checked);\r\n      this.notify(); // selection change\r\n      return;\r\n    }\r\n\r\n    forEachVisibleLeafUnder(id, (leaf) => {\r\n      this.assignments.set(leaf, checked);\r\n    });\r\n    this.notify(); // selection change\r\n  }\r\n}\r\n","import type { CSSProperties, FC, ReactNode } from \"react\";\r\n\r\nimport type { TreeDefinition, TreeItem } from \"./types\";\r\n\r\nimport { useVirtualizer } from \"@tanstack/react-virtual\";\r\nimport React, {\r\n  forwardRef,\r\n  useCallback,\r\n  useEffect,\r\n  useImperativeHandle,\r\n  useLayoutEffect,\r\n  useMemo,\r\n  useReducer,\r\n  useRef,\r\n} from \"react\";\r\n\r\nimport { CheckedState } from \"./constants\";\r\nimport { Engine } from \"./engine\";\r\n\r\nexport type TreeCheckboxRenderProps = {\r\n  id: string;\r\n  checkedState: CheckedState;\r\n  isFolder: boolean;\r\n  isExpanded: boolean;\r\n  isFocused: boolean;\r\n  level: number;\r\n  item: TreeItem;\r\n  onChange: (nextChecked: boolean) => void;\r\n};\r\n\r\nexport type TreeExpanderRenderProps = {\r\n  id: string;\r\n  isFolder: boolean;\r\n  isExpanded: boolean;\r\n  level: number;\r\n  item: TreeItem;\r\n  onToggle: () => void;\r\n};\r\n\r\nexport type TreeProps = {\r\n  /** Optional controlled list of checked leaf IDs. */\r\n  checkedItems?: null | string[];\r\n  /** Additional className for outer scroll container. */\r\n  className?: string;\r\n  /** Must include \"\\_\\_root\\_\\_\" node */\r\n  data: TreeDefinition;\r\n  /** Optional controlled list of expanded folder IDs. */\r\n  expandedItems?: null | string[];\r\n  /** Height of the scroll container. Defaults to \"100%\". */\r\n  height?: number | string;\r\n  /** Defaults to 3 */\r\n  minSearchChars?: number;\r\n  /** Called whenever the set of checked leaf IDs changes. */\r\n  onCheck?: (selection: string[]) => void;\r\n  /** Called whenever the list of expanded folder IDs changes. */\r\n  onExpand?: (expanded: string[]) => void;\r\n  /** Custom checkbox renderer. Default uses <input type=\"checkbox\" />. */\r\n  renderCheckbox?: (props: TreeCheckboxRenderProps) => ReactNode;\r\n  /** Custom expander renderer. Default uses a small +/- button. */\r\n  renderExpander?: (props: TreeExpanderRenderProps) => ReactNode;\r\n  /** Custom row content (label, icon, etc). Default uses item.label. */\r\n  renderItem?: (item: TreeItem) => ReactNode;\r\n  /** Current search query (controlled). */\r\n  searchQuery?: string;\r\n};\r\n\r\nexport type TreeRef = {\r\n  collapseAll: () => void;\r\n  expandAll: () => void;\r\n  scrollToId?: (id: string) => void;\r\n};\r\n\r\nexport const Tree = forwardRef<TreeRef, TreeProps>(\r\n  (\r\n    {\r\n      checkedItems,\r\n      className,\r\n      data,\r\n      expandedItems,\r\n      height,\r\n      minSearchChars = 3,\r\n      onCheck,\r\n      onExpand,\r\n      renderItem,\r\n      renderCheckbox,\r\n      renderExpander,\r\n      searchQuery,\r\n    },\r\n    ref\r\n  ) => {\r\n    const engine = useMemo(\r\n      () => new Engine(data, { minSearchChars }),\r\n      [data, minSearchChars]\r\n    );\r\n\r\n    // React to engine notifications\r\n    const [, force] = useReducer((x) => x + 1, 0);\r\n    useEffect(() => engine.subscribe(force), [engine]);\r\n\r\n    // Upstream events\r\n    useEffect(() => {\r\n      let prevSelVer = engine.getSelectionVersion();\r\n      let prevExpVer = engine.getExpandVersion();\r\n\r\n      return engine.subscribe(() => {\r\n        const selVer = engine.getSelectionVersion();\r\n        const expVer = engine.getExpandVersion();\r\n\r\n        if (selVer !== prevSelVer) {\r\n          prevSelVer = selVer;\r\n          onCheck?.(engine.getAllChecked());\r\n        }\r\n        if (expVer !== prevExpVer) {\r\n          prevExpVer = expVer;\r\n          onExpand?.(engine.getExpanded());\r\n        }\r\n\r\n        force();\r\n      });\r\n    }, [engine, onCheck, onExpand]);\r\n\r\n    // Controlled: checked items (allow empty array)\r\n    useEffect(() => {\r\n      if (!checkedItems) return;\r\n      engine.setChecked(checkedItems, true);\r\n    }, [checkedItems, engine]);\r\n\r\n    // Controlled: expanded items (optional override)\r\n    useEffect(() => {\r\n      if (expandedItems) engine.setExpanded(expandedItems);\r\n    }, [expandedItems, engine]);\r\n\r\n    // Controlled: search\r\n    useEffect(() => {\r\n      engine.setSearchQuery(searchQuery ?? \"\");\r\n    }, [engine, searchQuery]);\r\n\r\n    // View-aware rows (filtered or full)\r\n    const items = engine.getVisibleItems();\r\n\r\n    const pRef = useRef<HTMLDivElement | null>(null);\r\n    const virtualizer = useVirtualizer({\r\n      count: items.length,\r\n      estimateSize: () => 32,\r\n      getItemKey: (i) => items[i]?.id,\r\n      getScrollElement: () => pRef.current,\r\n      overscan: 5,\r\n    });\r\n    useLayoutEffect(() => {\r\n      virtualizer.measure();\r\n    }, [virtualizer, height]);\r\n\r\n    useImperativeHandle(\r\n      ref,\r\n      () => ({\r\n        collapseAll: () => engine.collapseAll(),\r\n        expandAll: () => engine.expandAll(),\r\n        scrollToId: (id: string) => {\r\n          const i = engine.indexOf(id);\r\n          if (i >= 0) virtualizer.scrollToIndex(i);\r\n        },\r\n      }),\r\n      [engine, virtualizer]\r\n    );\r\n\r\n    const handleCheckboxChange = useCallback(\r\n      (id: string, checked: boolean) => {\r\n        engine.toggle(id, checked); // context-aware: filtered vs full\r\n      },\r\n      [engine]\r\n    );\r\n\r\n    return (\r\n      <div\r\n        className={className}\r\n        ref={pRef}\r\n        style={{\r\n          height: height ?? \"100%\",\r\n          overflow: \"auto\",\r\n          position: \"relative\",\r\n        }}\r\n      >\r\n        <div\r\n          className=\"relative min-w-full\"\r\n          style={{\r\n            height: `${virtualizer.getTotalSize()}px`,\r\n          }}\r\n        >\r\n          {virtualizer.getVirtualItems().map((vi) => {\r\n            const row = items[vi.index];\r\n            if (!row) return null;\r\n\r\n            const { id, isFolder } = row;\r\n            const isExpanded = row.isExpanded;\r\n            const level = row.level >= 0 ? row.level : 0;\r\n            const checkedState = engine.getViewState(id);\r\n\r\n            return (\r\n              <TreeRow\r\n                checkedState={checkedState}\r\n                id={id}\r\n                isExpanded={isExpanded}\r\n                isFocused={false}\r\n                isFolder={isFolder}\r\n                item={data[id]}\r\n                key={id}\r\n                level={level}\r\n                onCheckboxChange={handleCheckboxChange}\r\n                onToggleExpand={() => engine.toggleExpanded(id)}\r\n                renderCheckbox={renderCheckbox}\r\n                renderExpander={renderExpander}\r\n                renderItem={renderItem}\r\n                virtualItem={vi}\r\n              />\r\n            );\r\n          })}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n);\r\nTree.displayName = \"Tree\";\r\n\r\nconst TreeRow = React.memo<{\r\n  checkedState: CheckedState;\r\n  id: string;\r\n  isExpanded: boolean;\r\n  isFocused: boolean;\r\n  isFolder: boolean;\r\n  item: TreeItem;\r\n  level: number;\r\n  onCheckboxChange: (id: string, checked: boolean) => void;\r\n  onToggleExpand: () => void;\r\n  renderItem?: (item: TreeItem) => ReactNode;\r\n  renderCheckbox?: (props: TreeCheckboxRenderProps) => ReactNode;\r\n  renderExpander?: (props: TreeExpanderRenderProps) => ReactNode;\r\n  virtualItem: { size: number; start: number };\r\n}>(\r\n  ({\r\n    checkedState,\r\n    id,\r\n    isExpanded,\r\n    isFocused,\r\n    isFolder,\r\n    item,\r\n    level,\r\n    onCheckboxChange,\r\n    onToggleExpand,\r\n    renderItem,\r\n    renderCheckbox,\r\n    renderExpander,\r\n    virtualItem,\r\n  }) => {\r\n    const handleRowClick = useCallback(() => {\r\n      if (isFolder) onToggleExpand();\r\n    }, [isFolder, onToggleExpand]);\r\n\r\n    const handleCheckboxClick = useCallback(\r\n      (checked: \"indeterminate\" | boolean) => {\r\n        const nextChecked = checked === \"indeterminate\" ? true : checked;\r\n        onCheckboxChange(id, nextChecked);\r\n      },\r\n      [id, onCheckboxChange]\r\n    );\r\n\r\n    // ----- defaults (headless but with basic HTML) -----\r\n\r\n    const DefaultExpander: FC<TreeExpanderRenderProps> = ({\r\n      isExpanded,\r\n      onToggle,\r\n    }) => (\r\n      <button\r\n        type=\"button\"\r\n        aria-label={isExpanded ? \"Collapse\" : \"Expand\"}\r\n        onClick={(e) => {\r\n          e.stopPropagation();\r\n          onToggle();\r\n        }}\r\n        style={{\r\n          marginRight: 4,\r\n          width: 16,\r\n          height: 16,\r\n          fontSize: 10,\r\n          display: \"inline-flex\",\r\n          alignItems: \"center\",\r\n          justifyContent: \"center\",\r\n        }}\r\n      >\r\n        {isExpanded ? \"-\" : \"+\"}\r\n      </button>\r\n    );\r\n\r\n    const DefaultCheckbox: FC<TreeCheckboxRenderProps> = ({\r\n      checkedState,\r\n      onChange,\r\n    }) => {\r\n      const t = radixChecked(checkedState);\r\n      return (\r\n        <input\r\n          type=\"checkbox\"\r\n          checked={t === true}\r\n          ref={(el) => {\r\n            if (el) el.indeterminate = t === \"indeterminate\";\r\n          }}\r\n          onClick={(e) => e.stopPropagation()}\r\n          onChange={(e) => onChange(e.target.checked)}\r\n          style={{ marginRight: 6 }}\r\n        />\r\n      );\r\n    };\r\n\r\n    const ExpanderComp = renderExpander ?? DefaultExpander;\r\n    const CheckboxComp = renderCheckbox ?? DefaultCheckbox;\r\n\r\n    const rs: CSSProperties = {\r\n      position: \"absolute\",\r\n      top: 0,\r\n      left: 0,\r\n      height: `${virtualItem.size}px`,\r\n      transform: `translateY(${virtualItem.start}px)`,\r\n      paddingLeft: `${level * 20 + (!isFolder ? 6 : 0)}px`,\r\n      display: \"flex\",\r\n      alignItems: \"center\",\r\n      gap: 4,\r\n      whiteSpace: \"nowrap\",\r\n      width: \"max-content\",\r\n      minWidth: \"100%\",\r\n      cursor: isFolder ? \"pointer\" : \"default\",\r\n    };\r\n\r\n    return (\r\n      <div\r\n        aria-expanded={isFolder ? isExpanded : undefined}\r\n        aria-selected={checkedState === CheckedState.Checked}\r\n        className=\"rt-tree-row\"\r\n        onClick={handleRowClick}\r\n        role=\"treeitem\"\r\n        style={rs}\r\n      >\r\n        {isFolder && (\r\n          <ExpanderComp\r\n            id={id}\r\n            isFolder={isFolder}\r\n            isExpanded={isExpanded}\r\n            level={level}\r\n            item={item}\r\n            onToggle={onToggleExpand}\r\n          />\r\n        )}\r\n\r\n        <CheckboxComp\r\n          id={id}\r\n          checkedState={checkedState}\r\n          isFolder={isFolder}\r\n          isExpanded={isExpanded}\r\n          isFocused={isFocused}\r\n          level={level}\r\n          item={item}\r\n          onChange={handleCheckboxClick}\r\n        />\r\n\r\n        <div className=\"rt-tree-label\">\r\n          {renderItem ? renderItem(item) : item.label}\r\n        </div>\r\n      </div>\r\n    );\r\n  },\r\n  (a, b) =>\r\n    a.id === b.id &&\r\n    a.isFolder === b.isFolder &&\r\n    a.checkedState === b.checkedState &&\r\n    a.isExpanded === b.isExpanded &&\r\n    a.isFocused === b.isFocused &&\r\n    a.level === b.level &&\r\n    a.item === b.item &&\r\n    a.renderItem === b.renderItem &&\r\n    a.renderCheckbox === b.renderCheckbox &&\r\n    a.renderExpander === b.renderExpander &&\r\n    a.virtualItem.start === b.virtualItem.start &&\r\n    a.virtualItem.size === b.virtualItem.size\r\n);\r\nTreeRow.displayName = \"TreeRow\";\r\n\r\nconst radixChecked = (state: CheckedState): \"indeterminate\" | boolean => {\r\n  if (state === CheckedState.Checked) return true;\r\n  if (state === CheckedState.Indeterminate) return \"indeterminate\";\r\n  return false;\r\n};\r\n"]}